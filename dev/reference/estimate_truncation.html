<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate Truncation of Observed Data — estimate_truncation • EpiNow2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate Truncation of Observed Data — estimate_truncation"><meta name="description" content="
Estimates a truncation distribution from multiple snapshots of the same
data source over time. This distribution can then be used passed to the
truncation argument in regional_epinow(), epinow(), and
estimate_infections() to adjust for truncated data and propagate the
uncertainty associated with data truncation into the estimates.
See here
for an example of using this approach on Covid-19 data in England. The
functionality offered by this function is now available in a more principled
manner in the epinowcast R package.
The model of truncation is as follows:
The truncation distribution is assumed to be discretised log normal wit
a mean and standard deviation that is informed by the data.
The data set with the latest observations is adjusted for truncation using
the truncation distribution.
Earlier data sets are recreated by applying the truncation distribution to
the adjusted latest observations in the time period of the earlier data set.
These data sets are then compared to the earlier observations assuming a
negative binomial observation model with an additive noise term to deal with
zero observations.


This model is then fit using stan with standard normal, or half normal,
prior for the mean, standard deviation, 1 over the square root of the
overdispersion and additive noise term.
This approach assumes that:
Current truncation is related to past truncation.
Truncation is a multiplicative scaling of underlying reported cases.
Truncation is log normally distributed.

"><meta property="og:description" content="
Estimates a truncation distribution from multiple snapshots of the same
data source over time. This distribution can then be used passed to the
truncation argument in regional_epinow(), epinow(), and
estimate_infections() to adjust for truncated data and propagate the
uncertainty associated with data truncation into the estimates.
See here
for an example of using this approach on Covid-19 data in England. The
functionality offered by this function is now available in a more principled
manner in the epinowcast R package.
The model of truncation is as follows:
The truncation distribution is assumed to be discretised log normal wit
a mean and standard deviation that is informed by the data.
The data set with the latest observations is adjusted for truncation using
the truncation distribution.
Earlier data sets are recreated by applying the truncation distribution to
the adjusted latest observations in the time period of the earlier data set.
These data sets are then compared to the earlier observations assuming a
negative binomial observation model with an additive noise term to deal with
zero observations.


This model is then fit using stan with standard normal, or half normal,
prior for the mean, standard deviation, 1 over the square root of the
overdispersion and additive noise term.
This approach assumes that:
Current truncation is related to past truncation.
Truncation is a multiplicative scaling of underlying reported cases.
Truncation is log normally distributed.

"><meta property="og:image" content="https://epiforecasts.io/EpiNow2/reference/figures/unnamed-chunk-14-1.png"><meta property="og:image:alt" content="Example estimates produced by EpiNow2 of the reproduction number, cases by date of infection and cases by date of report"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@seabbs"><meta name="twitter:site" content="@epiforecasts"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiNow2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.6.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/EpiNow2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-model-definitions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Model definitions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-model-definitions"><li><a class="dropdown-item" href="../articles/estimate_infections.html">estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_secondary.html">estimate_secondary()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_truncation.html">estimate_truncation()</a></li>
    <li><a class="dropdown-item" href="../articles/gaussian_process_implementation_details.html">Gaussian Process implementation details</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-usage" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Usage</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-usage"><li><a class="dropdown-item" href="../articles/estimate_infections_workflow.html">Workflow for Rt estimation and forecasting</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_infections_options.html">Examples: estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/epinow.html">Using epinow() for running in production mode</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case studies</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies"><li><a class="dropdown-item" href="../articles/case-studies.html">External case studies and use in the literature</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/EpiNow2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate Truncation of Observed Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/EpiNow2/blob/main/R/estimate_truncation.R" class="external-link"><code>R/estimate_truncation.R</code></a></small>
      <div class="d-none name"><code>estimate_truncation.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="figures/lifecycle-stable.svg" alt="[Stable]"></a>
Estimates a truncation distribution from multiple snapshots of the same
data source over time. This distribution can then be used passed to the
<code>truncation</code> argument in <code><a href="regional_epinow.html">regional_epinow()</a></code>, <code><a href="epinow.html">epinow()</a></code>, and
<code><a href="estimate_infections.html">estimate_infections()</a></code> to adjust for truncated data and propagate the
uncertainty associated with data truncation into the estimates.</p>
<p>See <a href="https://gist.github.com/seabbs/176b0c7f83eab1a7192a25b28bbd116a" class="external-link">here</a>
for an example of using this approach on Covid-19 data in England. The
functionality offered by this function is now available in a more principled
manner in the <a href="https://package.epinowcast.org/" class="external-link"><code>epinowcast</code> R package</a>.</p>
<p>The model of truncation is as follows:</p><ol><li><p>The truncation distribution is assumed to be discretised log normal wit
a mean and standard deviation that is informed by the data.</p></li>
<li><p>The data set with the latest observations is adjusted for truncation using
the truncation distribution.</p></li>
<li><p>Earlier data sets are recreated by applying the truncation distribution to
the adjusted latest observations in the time period of the earlier data set.
These data sets are then compared to the earlier observations assuming a
negative binomial observation model with an additive noise term to deal with
zero observations.</p></li>
</ol><p>This model is then fit using <code>stan</code> with standard normal, or half normal,
prior for the mean, standard deviation, 1 over the square root of the
overdispersion and additive noise term.</p>
<p>This approach assumes that:</p><ul><li><p>Current truncation is related to past truncation.</p></li>
<li><p>Truncation is a multiplicative scaling of underlying reported cases.</p></li>
<li><p>Truncation is log normally distributed.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estimate_truncation</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  truncation <span class="op">=</span> <span class="fu"><a href="trunc_opts.html">trunc_opts</a></span><span class="op">(</span><span class="fu"><a href="Distributions.html">LogNormal</a></span><span class="op">(</span>meanlog <span class="op">=</span> <span class="fu"><a href="Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, sdlog <span class="op">=</span> <span class="fu"><a href="Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, max <span class="op">=</span></span>
<span>    <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stan <span class="op">=</span> <span class="fu"><a href="stan_opts.html">stan_opts</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  CrIs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  filter_leading_zeros <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  zero_threshold <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  weigh_delay_priors <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">obs</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A list of <code>&lt;data.frame&gt;</code>s each containing a date variable
and a confirm (numeric) variable. Each data set should be a snapshot
of the reported data over time. All data sets must contain a complete vector
of dates.</p></dd>


<dt id="arg-truncation">truncation<a class="anchor" aria-label="anchor" href="#arg-truncation"></a></dt>
<dd><p>A call to <code><a href="trunc_opts.html">trunc_opts()</a></code> defining the truncation of
the observed data. Defaults to <code><a href="trunc_opts.html">trunc_opts()</a></code>, i.e. no truncation.  See the
<code>estimate_truncation()</code> help file for an approach to estimating this from
data where the <code>dist</code> list element returned by <code>estimate_truncation()</code> is
used as the <code>truncation</code> argument here, thereby propagating the uncertainty
in the estimate.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A compiled stan model to override the default model. May be
useful for package developers or those developing extensions.</p></dd>


<dt id="arg-stan">stan<a class="anchor" aria-label="anchor" href="#arg-stan"></a></dt>
<dd><p>A list of stan options as generated by <code><a href="stan_opts.html">stan_opts()</a></code>. Defaults
to <code><a href="stan_opts.html">stan_opts()</a></code>. Can be used to override <code>data</code>, <code>init</code>, and <code>verbose</code>
settings if desired.</p></dd>


<dt id="arg-cris">CrIs<a class="anchor" aria-label="anchor" href="#arg-cris"></a></dt>
<dd><p>Numeric vector of credible intervals to calculate.</p></dd>


<dt id="arg-filter-leading-zeros">filter_leading_zeros<a class="anchor" aria-label="anchor" href="#arg-filter-leading-zeros"></a></dt>
<dd><p>Logical, defaults to TRUE. Should zeros at the
start of the time series be filtered out.</p></dd>


<dt id="arg-zero-threshold">zero_threshold<a class="anchor" aria-label="anchor" href="#arg-zero-threshold"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a> Numeric defaults
to Inf. Indicates if detected zero cases are meaningful by using a threshold
number of cases based on the 7-day average. If the average is above this
threshold then the zero is replaced using <code>fill</code>.</p></dd>


<dt id="arg-weigh-delay-priors">weigh_delay_priors<a class="anchor" aria-label="anchor" href="#arg-weigh-delay-priors"></a></dt>
<dd><p>Deprecated; use the <code>weight_prior</code> option in
<code><a href="trunc_opts.html">trunc_opts()</a></code> instead.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical, should model fitting progress be returned.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional parameters to pass to <code><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">rstan::sampling()</a></code>.</p></dd>


<dt id="arg-obs">obs<a class="anchor" aria-label="anchor" href="#arg-obs"></a></dt>
<dd><p>Deprecated; use <code>data</code> instead.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing: the summary parameters of the truncation
distribution (<code>dist</code>), which could be passed to the <code>truncation</code> argument
of <code><a href="epinow.html">epinow()</a></code>, <code><a href="regional_epinow.html">regional_epinow()</a></code>, and <code><a href="estimate_infections.html">estimate_infections()</a></code>, the
estimated CMF of the truncation distribution (<code>cmf</code>, can be used to
adjusted new data), a <code>&lt;data.frame&gt;</code> containing the observed truncated
data, latest observed data and the adjusted for
truncation observations (<code>obs</code>), a <code>&lt;data.frame&gt;</code> containing the last
observed data (<code>last_obs</code>, useful for plotting and validation), the data
used for fitting (<code>data</code>) and the fit object (<code>fit</code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># set number of cores to use</span></span></span>
<span class="r-in"><span><span class="va">old_opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit model to example data</span></span></span>
<span class="r-in"><span><span class="co"># See [example_truncated] for more details</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">estimate_truncation</span><span class="op">(</span><span class="va">example_truncated</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">2000</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2024-11-20 21:41:12] estimate_truncation (chain: 1): There were 13 divergent transitions after warmup. See</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> to find out why this is a problem and how to eliminate them. - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2024-11-20 21:41:12] estimate_truncation (chain: 1): Examine the pairs() plot to diagnose sampling problems</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># summary of the distribution</span></span></span>
<span class="r-in"><span><span class="va">est</span><span class="op">$</span><span class="va">dist</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - lognormal distribution (max: 10):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   meanlog:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     - normal distribution:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       mean:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         -1.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       sd:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         0.44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sdlog:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     - normal distribution:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       mean:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         2.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       sd:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         0.67</span>
<span class="r-in"><span><span class="co"># summary of the estimated truncation cmf (can be applied to new data)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">cmf</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     index      mean      se_mean           sd  lower_90  lower_50  lower_20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;int&gt;     &lt;num&gt;        &lt;num&gt;        &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1:     1 1.0000000 2.780918e-18 1.266409e-16 1.0000000 1.0000000 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2:     2 0.9972697 4.578098e-05 1.544848e-03 0.9945896 0.9962553 0.9969574</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3:     3 0.9939694 9.822047e-05 3.306885e-03 0.9883080 0.9917468 0.9932489</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4:     4 0.9898910 1.590847e-04 5.340466e-03 0.9808598 0.9862905 0.9886655</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5:     5 0.9847074 2.308744e-04 7.720209e-03 0.9717122 0.9794273 0.9828561</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6:     6 0.9778715 3.172762e-04 1.055081e-02 0.9603821 0.9707062 0.9751489</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7:     7 0.9683860 4.240227e-04 1.398133e-02 0.9457122 0.9586898 0.9646073</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8:     8 0.9541977 5.606975e-04 1.821937e-02 0.9252773 0.9416227 0.9488966</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9:     9 0.9301743 7.432896e-04 2.348965e-02 0.8938073 0.9139986 0.9231522</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10:    10 0.8774534 7.609753e-04 2.874396e-02 0.8336208 0.8578146 0.8686479</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:    11 0.4200676 3.376956e-04 1.622621e-02 0.3949625 0.4091080 0.4150474</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        median  upper_20  upper_50  upper_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: 1.0000000 1.0000000 1.0000000 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: 0.9973522 0.9977825 0.9984388 0.9996632</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: 0.9941155 0.9950385 0.9964539 0.9991955</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: 0.9900866 0.9915739 0.9938330 0.9984845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: 0.9848437 0.9870497 0.9903998 0.9973814</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: 0.9777995 0.9808080 0.9855063 0.9956075</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: 0.9681051 0.9718943 0.9782113 0.9924641</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: 0.9534405 0.9582225 0.9664334 0.9863304</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: 0.9284525 0.9345937 0.9450346 0.9717261</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: 0.8751554 0.8824865 0.8946820 0.9274613</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: 0.4187792 0.4233016 0.4299526 0.4471744</span>
<span class="r-in"><span><span class="co"># observations linked to truncation adjusted estimates</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           date confirm last_confirm report_date  mean se_mean    sd lower_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;Date&gt;   &lt;num&gt;        &lt;num&gt;      &lt;Date&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;    &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: 2020-03-24    4764         4789  2020-04-01  5244       0    28     5198</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: 2020-03-25    5191         5249  2020-04-01  5181       1    40     5115</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: 2020-03-26    5102         5210  2020-04-01  6058       1    65     5950</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: 2020-03-27    5924         6153  2020-04-01  5749       2    83     5609</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: 2020-03-28    5567         5959  2020-04-01  5544       3   105     5362</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: 2020-03-29    5289         5974  2020-04-01  4499       3   112     4304</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: 2020-03-30    4183         5217  2020-04-01  3043       2    98     2876</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: 2020-03-31    2668         4050  2020-04-01  4007       2   152     3759</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: 2020-04-01    1681         4053  2020-04-01     0      NA     0        0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: 2020-03-29    5970         5974  2020-04-06  6006       0    20     5974</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: 2020-03-30    5209         5217  2020-04-06  5262       0    28     5216</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12: 2020-03-31    4035         4050  2020-04-06  4097       0    32     4045</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13: 2020-04-01    4020         4053  2020-04-06  4111       1    44     4037</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14: 2020-04-02    4697         4782  2020-04-06  4851       2    70     4732</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15: 2020-04-03    4483         4668  2020-04-06  4699       2    89     4545</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16: 2020-04-04    4182         4585  2020-04-06  4498       3   112     4303</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17: 2020-04-05    3864         4805  2020-04-06  4408       3   142     4166</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18: 2020-04-06    2420         4316  2020-04-06  5769       4   219     5411</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19: 2020-04-03    4653         4668  2020-04-11  4681       0    15     4656</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20: 2020-04-04    4554         4585  2020-04-11  4600       0    24     4560</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21: 2020-04-05    4741         4805  2020-04-11  4814       1    37     4753</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22: 2020-04-06    4208         4316  2020-04-11  4303       1    46     4226</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23: 2020-04-07    3431         3599  2020-04-11  3543       1    51     3457</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24: 2020-04-08    2779         3039  2020-04-11  2913       1    55     2817</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25: 2020-04-09    3234         3836  2020-04-11  3478       2    87     3328</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26: 2020-04-10    2993         4204  2020-04-11  3414       2   110     3227</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27: 2020-04-11    1848         3951  2020-04-11  4405       3   167     4132</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28: 2020-04-08    3036         3039  2020-04-16  3054       0    10     3038</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29: 2020-04-09    3829         3836  2020-04-16  3868       0    20     3834</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30: 2020-04-10    4187         4204  2020-04-16  4252       0    33     4197</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31: 2020-04-11    3916         3951  2020-04-16  4005       1    43     3933</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32: 2020-04-12    4605         4686  2020-04-16  4756       2    68     4639</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33: 2020-04-13    3925         4074  2020-04-16  4114       2    78     3979</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34: 2020-04-14    2873         3124  2020-04-16  3090       2    77     2956</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35: 2020-04-15    2393         2919  2020-04-16  2730       2    88     2580</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36: 2020-04-16    1512         2580  2020-04-16  3604       2   137     3381</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37: 2020-04-13    4074         4074  2020-04-21  4098       0    13     4077</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38: 2020-04-14    3124         3124  2020-04-21  3155       0    17     3128</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39: 2020-04-15    2919         2919  2020-04-21  2964       0    23     2926</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40: 2020-04-16    2580         2580  2020-04-21  2638       0    28     2591</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 41: 2020-04-17    3563         3563  2020-04-21  3680       1    53     3590</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 42: 2020-04-18    3126         3126  2020-04-21  3277       1    62     3169</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 43: 2020-04-19    2843         2843  2020-04-21  3058       2    76     2925</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44: 2020-04-20    2051         2051  2020-04-21  2339       1    75     2211</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 45: 2020-04-21     962          962  2020-04-21  2293       1    87     2151</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           date confirm last_confirm report_date  mean se_mean    sd lower_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lower_50 lower_20 median upper_20 upper_50 upper_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        &lt;int&gt;    &lt;int&gt;  &lt;int&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1:     5223     5235   5242     5250     5263     5292</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2:     5151     5168   5180     5190     5209     5250</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3:     6011     6039   6058     6074     6102     6168</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4:     5690     5727   5750     5771     5806     5886</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5:     5472     5519   5547     5573     5616     5716</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6:     4426     4475   4505     4531     4576     4679</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7:     2982     3023   3048     3071     3110     3200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8:     3909     3971   4014     4050     4108     4256</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9:        0        0      0        0        0        0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10:     5991     5999   6005     6010     6019     6040</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:     5241     5253   5261     5268     5281     5310</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12:     4074     4087   4097     4105     4119     4152</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13:     4079     4098   4111     4122     4141     4185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14:     4801     4832   4851     4869     4899     4966</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15:     4638     4678   4701     4724     4760     4845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16:     4425     4474   4504     4530     4575     4678</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17:     4318     4378   4415     4448     4504     4635</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18:     5628     5716   5778     5830     5915     6127</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19:     4669     4676   4680     4684     4691     4708</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20:     4582     4592   4599     4606     4617     4642</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21:     4786     4803   4813     4823     4840     4879</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22:     4269     4290   4303     4315     4334     4381</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23:     3507     3530   3544     3556     3578     3627</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24:     2875     2900   2914     2928     2951     3003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25:     3422     3460   3483     3503     3538     3618</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26:     3345     3391   3419     3445     3489     3590</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27:     4298     4365   4412     4452     4517     4678</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28:     3046     3051   3053     3056     3061     3071</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29:     3852     3861   3867     3872     3882     3903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30:     4227     4241   4251     4260     4274     4308</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31:     3973     3992   4004     4015     4034     4077</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32:     4707     4738   4756     4773     4803     4869</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33:     4061     4096   4116     4136     4168     4241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34:     3040     3074   3094     3112     3143     3214</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35:     2674     2711   2734     2754     2789     2870</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36:     3516     3571   3610     3642     3695     3828</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37:     4088     4094   4098     4101     4107     4122</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38:     3143     3150   3155     3159     3167     3184</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39:     2947     2957   2963     2969     2980     3003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40:     2617     2630   2638     2645     2657     2686</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 41:     3642     3666   3680     3693     3716     3767</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 42:     3234     3262   3278     3294     3319     3378</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 43:     3008     3041   3062     3079     3110     3180</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44:     2292     2324   2343     2361     2390     2460</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 45:     2237     2272   2297     2317     2351     2435</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lower_50 lower_20 median upper_20 upper_50 upper_90</span>
<span class="r-in"><span><span class="co"># validation plot of observations vs estimates</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.estimate_infections.html">plot</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_truncation-1.png" alt="" width="864" height="864"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pass the truncation distribution to `epinow()`.</span></span></span>
<span class="r-in"><span><span class="co"># Note, we're using the last snapshot as the observed data as it contains</span></span></span>
<span class="r-in"><span><span class="co"># all the previous snapshots. Also, we're using the default options for</span></span></span>
<span class="r-in"><span><span class="co"># illustrative purposes only.</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="epinow.html">epinow</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">example_truncated</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  truncation <span class="op">=</span> <span class="fu"><a href="trunc_opts.html">trunc_opts</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">dist</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Logging threshold set at INFO for the name logger</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Writing <span style="color: #0000BB;">EpiNow2</span> logs to the console and:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">/tmp/Rtmp0uQ2BV/regional-epinow/2020-04-21.log</span>.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Logging threshold set at INFO for the name logger</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Writing <span style="color: #0000BB;">EpiNow2.epinow</span> logs to the console and:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">/tmp/Rtmp0uQ2BV/epinow/2020-04-21.log</span>.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2024-11-20 21:41:14] epinow: <span style="color: #BBBB00;">!</span> No generation time distribution given.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Now using a fixed generation time of 1 day, i.e. the reproduction number is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   the same as the daily growth rate.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> If this was intended then this warning can be silenced by setting `dist =</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Fixed(1)`'. - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2024-11-20 21:43:26] epinow: There were 8 divergent transitions after warmup. See</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> to find out why this is a problem and how to eliminate them. - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2024-11-20 21:43:26] epinow: Examine the pairs() plot to diagnose sampling problems</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - </span>
<span class="r-in"><span><span class="fu"><a href="plot.estimate_infections.html">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_truncation-2.png" alt="" width="864" height="864"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">old_opts</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Joel Hellewell, Katharine Sherratt, Katelyn Gostic, Joe Hickson, Hamada S. Badr, Michael DeWitt, James M. Azam, EpiForecasts, <a href="https://www.lshtm.ac.uk/aboutus/people/funk.sebastian" class="external-link">Sebastian Funk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

